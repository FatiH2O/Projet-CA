<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<title>Lua 5.1.5 source code - lopcodes.h</title>
<link rel="stylesheet" type="text/css" href="Lua%205.1.5%20source%20code%20-%20lopcodes.h_fichiers/lua.css">
<link rel="stylesheet" type="text/css" href="Lua%205.1.5%20source%20code%20-%20lopcodes.h_fichiers/source.css">
<meta http-equiv="content-type" content="text/html; charset=windows-1252">
</head>

<body>

<h1>
<a href="https://www.lua.org/home.html"><img src="Lua%205.1.5%20source%20code%20-%20lopcodes.h_fichiers/logo.gif" alt="Lua"></a>
lopcodes.h
<span class="note">(5.1.5)</span>
</h1>

<div class="menubar">
<a href="https://www.lua.org/source/5.1/">module index</a>
·
<a href="https://www.lua.org/source/5.1/idx.html">name index</a>
·
<a href="https://www.lua.org/source/">other versions</a>
</div>

<pre>/*
** $Id: lopcodes.h,v 1.125.1.1 2007/12/27 13:02:25 roberto Exp $
** Opcodes for Lua virtual machine
** See Copyright Notice in lua.h
*/

#ifndef <a href="https://www.lua.org/source/5.1/lopcodes.h.html#lopcodes_h">lopcodes_h</a>
#define <a name="lopcodes_h"><span class="definition">lopcodes_h</span></a>

#include "<a href="https://www.lua.org/source/5.1/llimits.h.html">llimits.h</a>"


/*===========================================================================
  We assume that instructions are unsigned numbers.
  All instructions have an opcode in the first 6 bits.
  Instructions can have the following fields:
        `A' : 8 bits
        `B' : 9 bits
        `C' : 9 bits
        `Bx' : 18 bits (`B' and `C' together)
        `sBx' : signed Bx

  A signed argument is represented in excess K; that is, the number
  value is the unsigned value minus K. K is exactly the maximum value
  for that argument (so that -max is represented by 0, and +max is
  represented by 2*max), which is half the maximum for the corresponding
  unsigned argument.
===========================================================================*/


enum <a name="OpMode"><span class="definition">OpMode</span></a> {<a name="iABC"><span class="definition">iABC</span></a>, <a name="iABx"><span class="definition">iABx</span></a>, <a name="iAsBx"><span class="definition">iAsBx</span></a>};  /* basic instruction format */


/*
** size and position of opcode arguments.
*/
#define <a name="SIZE_C"><span class="definition">SIZE_C</span></a>          9
#define <a name="SIZE_B"><span class="definition">SIZE_B</span></a>          9
#define <a name="SIZE_Bx"><span class="definition">SIZE_Bx</span></a>         (<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_C">SIZE_C</a> + <a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_B">SIZE_B</a>)
#define <a name="SIZE_A"><span class="definition">SIZE_A</span></a>          8

#define <a name="SIZE_OP"><span class="definition">SIZE_OP</span></a>         6

#define <a name="POS_OP"><span class="definition">POS_OP</span></a>          0
#define <a name="POS_A"><span class="definition">POS_A</span></a>           (<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_OP">POS_OP</a> + <a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_OP">SIZE_OP</a>)
#define <a name="POS_C"><span class="definition">POS_C</span></a>           (<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_A">POS_A</a> + <a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_A">SIZE_A</a>)
#define <a name="POS_B"><span class="definition">POS_B</span></a>           (<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_C">POS_C</a> + <a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_C">SIZE_C</a>)
#define <a name="POS_Bx"><span class="definition">POS_Bx</span></a>          <a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_C">POS_C</a>


/*
** limits for opcode arguments.
** we use (signed) int to manipulate most arguments,
** so they must fit in <a href="https://www.lua.org/source/5.1/luaconf.h.html#LUAI_BITSINT">LUAI_BITSINT</a>-1 bits (-1 for sign)
*/
#if <a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_Bx">SIZE_Bx</a> &lt; <a href="https://www.lua.org/source/5.1/luaconf.h.html#LUAI_BITSINT">LUAI_BITSINT</a>-1
#define <a href="https://www.lua.org/source/5.1/lopcodes.h.html#MAXARG_Bx">MAXARG_Bx</a>        ((1&lt;&lt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_Bx">SIZE_Bx</a>)-1)
#define <a href="https://www.lua.org/source/5.1/lopcodes.h.html#MAXARG_sBx">MAXARG_sBx</a>        (<a href="https://www.lua.org/source/5.1/lopcodes.h.html#MAXARG_Bx">MAXARG_Bx</a>&gt;&gt;1)         /* `sBx' is signed */
#else
#define <a name="MAXARG_Bx"><span class="definition">MAXARG_Bx</span></a>        <a href="https://www.lua.org/source/5.1/llimits.h.html#MAX_INT">MAX_INT</a>
#define <a name="MAXARG_sBx"><span class="definition">MAXARG_sBx</span></a>        <a href="https://www.lua.org/source/5.1/llimits.h.html#MAX_INT">MAX_INT</a>
#endif


#define <a name="MAXARG_A"><span class="definition">MAXARG_A</span></a>        ((1&lt;&lt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_A">SIZE_A</a>)-1)
#define <a name="MAXARG_B"><span class="definition">MAXARG_B</span></a>        ((1&lt;&lt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_B">SIZE_B</a>)-1)
#define <a name="MAXARG_C"><span class="definition">MAXARG_C</span></a>        ((1&lt;&lt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_C">SIZE_C</a>)-1)


/* creates a mask with `n' 1 bits at position `p' */
#define <a name="MASK1"><span class="definition">MASK1</span></a>(n,p)      ((~((~(<a href="https://www.lua.org/source/5.1/llimits.h.html#Instruction">Instruction</a>)0)&lt;&lt;n))&lt;&lt;p)

/* creates a mask with `n' 0 bits at position `p' */
#define <a name="MASK0"><span class="definition">MASK0</span></a>(n,p)      (~<a href="https://www.lua.org/source/5.1/lopcodes.h.html#MASK1">MASK1</a>(n,p))

/*
** the following macros help to manipulate instructions
*/

#define <a name="GET_OPCODE"><span class="definition">GET_OPCODE</span></a>(i)   (<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(<a href="https://www.lua.org/source/5.1/lopcodes.h.html#OpCode">OpCode</a>, ((i)&gt;&gt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_OP">POS_OP</a>) &amp; <a href="https://www.lua.org/source/5.1/lopcodes.h.html#MASK1">MASK1</a>(<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_OP">SIZE_OP</a>,0)))
#define <a name="SET_OPCODE"><span class="definition">SET_OPCODE</span></a>(i,o) ((i) = (((i)&amp;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#MASK0">MASK0</a>(<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_OP">SIZE_OP</a>,<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_OP">POS_OP</a>)) | \
                ((<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(<a href="https://www.lua.org/source/5.1/llimits.h.html#Instruction">Instruction</a>, o)&lt;&lt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_OP">POS_OP</a>)&amp;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#MASK1">MASK1</a>(<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_OP">SIZE_OP</a>,<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_OP">POS_OP</a>))))

#define <a name="GETARG_A"><span class="definition">GETARG_A</span></a>(i)     (<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(int, ((i)&gt;&gt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_A">POS_A</a>) &amp; <a href="https://www.lua.org/source/5.1/lopcodes.h.html#MASK1">MASK1</a>(<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_A">SIZE_A</a>,0)))
#define <a name="SETARG_A"><span class="definition">SETARG_A</span></a>(i,u)   ((i) = (((i)&amp;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#MASK0">MASK0</a>(<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_A">SIZE_A</a>,<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_A">POS_A</a>)) | \
                ((<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(<a href="https://www.lua.org/source/5.1/llimits.h.html#Instruction">Instruction</a>, u)&lt;&lt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_A">POS_A</a>)&amp;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#MASK1">MASK1</a>(<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_A">SIZE_A</a>,<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_A">POS_A</a>))))

#define <a name="GETARG_B"><span class="definition">GETARG_B</span></a>(i)     (<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(int, ((i)&gt;&gt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_B">POS_B</a>) &amp; <a href="https://www.lua.org/source/5.1/lopcodes.h.html#MASK1">MASK1</a>(<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_B">SIZE_B</a>,0)))
#define <a name="SETARG_B"><span class="definition">SETARG_B</span></a>(i,b)   ((i) = (((i)&amp;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#MASK0">MASK0</a>(<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_B">SIZE_B</a>,<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_B">POS_B</a>)) | \
                ((<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(<a href="https://www.lua.org/source/5.1/llimits.h.html#Instruction">Instruction</a>, b)&lt;&lt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_B">POS_B</a>)&amp;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#MASK1">MASK1</a>(<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_B">SIZE_B</a>,<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_B">POS_B</a>))))

#define <a name="GETARG_C"><span class="definition">GETARG_C</span></a>(i)     (<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(int, ((i)&gt;&gt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_C">POS_C</a>) &amp; <a href="https://www.lua.org/source/5.1/lopcodes.h.html#MASK1">MASK1</a>(<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_C">SIZE_C</a>,0)))
#define <a name="SETARG_C"><span class="definition">SETARG_C</span></a>(i,b)   ((i) = (((i)&amp;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#MASK0">MASK0</a>(<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_C">SIZE_C</a>,<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_C">POS_C</a>)) | \
                ((<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(<a href="https://www.lua.org/source/5.1/llimits.h.html#Instruction">Instruction</a>, b)&lt;&lt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_C">POS_C</a>)&amp;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#MASK1">MASK1</a>(<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_C">SIZE_C</a>,<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_C">POS_C</a>))))

#define <a name="GETARG_Bx"><span class="definition">GETARG_Bx</span></a>(i)    (<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(int, ((i)&gt;&gt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_Bx">POS_Bx</a>) &amp; <a href="https://www.lua.org/source/5.1/lopcodes.h.html#MASK1">MASK1</a>(<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_Bx">SIZE_Bx</a>,0)))
#define <a name="SETARG_Bx"><span class="definition">SETARG_Bx</span></a>(i,b)  ((i) = (((i)&amp;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#MASK0">MASK0</a>(<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_Bx">SIZE_Bx</a>,<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_Bx">POS_Bx</a>)) | \
                ((<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(<a href="https://www.lua.org/source/5.1/llimits.h.html#Instruction">Instruction</a>, b)&lt;&lt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_Bx">POS_Bx</a>)&amp;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#MASK1">MASK1</a>(<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_Bx">SIZE_Bx</a>,<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_Bx">POS_Bx</a>))))

#define <a name="GETARG_sBx"><span class="definition">GETARG_sBx</span></a>(i)   (<a href="https://www.lua.org/source/5.1/lopcodes.h.html#GETARG_Bx">GETARG_Bx</a>(i)-<a href="https://www.lua.org/source/5.1/lopcodes.h.html#MAXARG_sBx">MAXARG_sBx</a>)
#define <a name="SETARG_sBx"><span class="definition">SETARG_sBx</span></a>(i,b) <a href="https://www.lua.org/source/5.1/lopcodes.h.html#SETARG_Bx">SETARG_Bx</a>((i),<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(unsigned int, (b)+<a href="https://www.lua.org/source/5.1/lopcodes.h.html#MAXARG_sBx">MAXARG_sBx</a>))


#define <a name="CREATE_ABC"><span class="definition">CREATE_ABC</span></a>(o,a,b,c)     ((<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(<a href="https://www.lua.org/source/5.1/llimits.h.html#Instruction">Instruction</a>, o)&lt;&lt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_OP">POS_OP</a>) \
                        | (<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(<a href="https://www.lua.org/source/5.1/llimits.h.html#Instruction">Instruction</a>, a)&lt;&lt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_A">POS_A</a>) \
                        | (<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(<a href="https://www.lua.org/source/5.1/llimits.h.html#Instruction">Instruction</a>, b)&lt;&lt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_B">POS_B</a>) \
                        | (<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(<a href="https://www.lua.org/source/5.1/llimits.h.html#Instruction">Instruction</a>, c)&lt;&lt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_C">POS_C</a>))

#define <a name="CREATE_ABx"><span class="definition">CREATE_ABx</span></a>(o,a,bc)      ((<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(<a href="https://www.lua.org/source/5.1/llimits.h.html#Instruction">Instruction</a>, o)&lt;&lt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_OP">POS_OP</a>) \
                        | (<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(<a href="https://www.lua.org/source/5.1/llimits.h.html#Instruction">Instruction</a>, a)&lt;&lt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_A">POS_A</a>) \
                        | (<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(<a href="https://www.lua.org/source/5.1/llimits.h.html#Instruction">Instruction</a>, bc)&lt;&lt;<a href="https://www.lua.org/source/5.1/lopcodes.h.html#POS_Bx">POS_Bx</a>))


/*
** Macros to operate RK indices
*/

/* this bit 1 means constant (0 means register) */
#define <a name="BITRK"><span class="definition">BITRK</span></a>           (1 &lt;&lt; (<a href="https://www.lua.org/source/5.1/lopcodes.h.html#SIZE_B">SIZE_B</a> - 1))

/* test whether value is a constant */
#define <a name="ISK"><span class="definition">ISK</span></a>(x)          ((x) &amp; <a href="https://www.lua.org/source/5.1/lopcodes.h.html#BITRK">BITRK</a>)

/* gets the index of the constant */
#define <a name="INDEXK"><span class="definition">INDEXK</span></a>(r)       ((int)(r) &amp; ~<a href="https://www.lua.org/source/5.1/lopcodes.h.html#BITRK">BITRK</a>)

#define <a name="MAXINDEXRK"><span class="definition">MAXINDEXRK</span></a>      (<a href="https://www.lua.org/source/5.1/lopcodes.h.html#BITRK">BITRK</a> - 1)

/* code a constant index as a RK value */
#define <a name="RKASK"><span class="definition">RKASK</span></a>(x)        ((x) | <a href="https://www.lua.org/source/5.1/lopcodes.h.html#BITRK">BITRK</a>)


/*
** invalid register that fits in 8 bits
*/
#define <a name="NO_REG"><span class="definition">NO_REG</span></a>          <a href="https://www.lua.org/source/5.1/lopcodes.h.html#MAXARG_A">MAXARG_A</a>


/*
** R(x) - register
** Kst(x) - constant (in constant table)
** RK(x) == if <a href="https://www.lua.org/source/5.1/lopcodes.h.html#ISK">ISK</a>(x) then Kst(<a href="https://www.lua.org/source/5.1/lopcodes.h.html#INDEXK">INDEXK</a>(x)) else R(x)
*/


/*
** grep "ORDER OP" if you change these enums
*/

typedef enum {
/*----------------------------------------------------------------------
name            args    description
------------------------------------------------------------------------*/
<a name="OP_MOVE"><span class="definition">OP_MOVE</span></a>,/*      A B     R(A) := R(B)                                    */
<a name="OP_LOADK"><span class="definition">OP_LOADK</span></a>,/*     A Bx    R(A) := Kst(Bx)                                 */
<a name="OP_LOADBOOL"><span class="definition">OP_LOADBOOL</span></a>,/*  A B C   R(A) := (Bool)B; if (C) pc++                    */
<a name="OP_LOADNIL"><span class="definition">OP_LOADNIL</span></a>,/*   A B     R(A) := ... := R(B) := nil                      */
<a name="OP_GETUPVAL"><span class="definition">OP_GETUPVAL</span></a>,/*  A B     R(A) := UpValue[B]                              */

<a name="OP_GETGLOBAL"><span class="definition">OP_GETGLOBAL</span></a>,/* A Bx    R(A) := Gbl[Kst(Bx)]                            */
<a name="OP_GETTABLE"><span class="definition">OP_GETTABLE</span></a>,/*  A B C   R(A) := R(B)[RK(C)]                             */

<a name="OP_SETGLOBAL"><span class="definition">OP_SETGLOBAL</span></a>,/* A Bx    Gbl[Kst(Bx)] := R(A)                            */
<a name="OP_SETUPVAL"><span class="definition">OP_SETUPVAL</span></a>,/*  A B     UpValue[B] := R(A)                              */
<a name="OP_SETTABLE"><span class="definition">OP_SETTABLE</span></a>,/*  A B C   R(A)[RK(B)] := RK(C)                            */

<a name="OP_NEWTABLE"><span class="definition">OP_NEWTABLE</span></a>,/*  A B C   R(A) := {} (size = B,C)                         */

<a name="OP_SELF"><span class="definition">OP_SELF</span></a>,/*      A B C   R(A+1) := R(B); R(A) := R(B)[RK(C)]             */

<a name="OP_ADD"><span class="definition">OP_ADD</span></a>,/*       A B C   R(A) := RK(B) + RK(C)                           */
<a name="OP_SUB"><span class="definition">OP_SUB</span></a>,/*       A B C   R(A) := RK(B) - RK(C)                           */
<a name="OP_MUL"><span class="definition">OP_MUL</span></a>,/*       A B C   R(A) := RK(B) * RK(C)                           */
<a name="OP_DIV"><span class="definition">OP_DIV</span></a>,/*       A B C   R(A) := RK(B) / RK(C)                           */
<a name="OP_MOD"><span class="definition">OP_MOD</span></a>,/*       A B C   R(A) := RK(B) % RK(C)                           */
<a name="OP_POW"><span class="definition">OP_POW</span></a>,/*       A B C   R(A) := RK(B) ^ RK(C)                           */
<a name="OP_UNM"><span class="definition">OP_UNM</span></a>,/*       A B     R(A) := -R(B)                                   */
<a name="OP_NOT"><span class="definition">OP_NOT</span></a>,/*       A B     R(A) := not R(B)                                */
<a name="OP_LEN"><span class="definition">OP_LEN</span></a>,/*       A B     R(A) := length of R(B)                          */

<a name="OP_CONCAT"><span class="definition">OP_CONCAT</span></a>,/*    A B C   R(A) := R(B).. ... ..R(C)                       */

<a name="OP_JMP"><span class="definition">OP_JMP</span></a>,/*       sBx     pc+=sBx                                 */

<a name="OP_EQ"><span class="definition">OP_EQ</span></a>,/*        A B C   if ((RK(B) == RK(C)) ~= A) then pc++            */
<a name="OP_LT"><span class="definition">OP_LT</span></a>,/*        A B C   if ((RK(B) &lt;  RK(C)) ~= A) then pc++            */
<a name="OP_LE"><span class="definition">OP_LE</span></a>,/*        A B C   if ((RK(B) &lt;= RK(C)) ~= A) then pc++            */

<a name="OP_TEST"><span class="definition">OP_TEST</span></a>,/*      A C     if not (R(A) &lt;=&gt; C) then pc++                   */ 
<a name="OP_TESTSET"><span class="definition">OP_TESTSET</span></a>,/*   A B C   if (R(B) &lt;=&gt; C) then R(A) := R(B) else pc++     */ 

<a name="OP_CALL"><span class="definition">OP_CALL</span></a>,/*      A B C   R(A), ... ,R(A+C-2) := R(A)(R(A+1), ... ,R(A+B-1)) */
<a name="OP_TAILCALL"><span class="definition">OP_TAILCALL</span></a>,/*  A B C   return R(A)(R(A+1), ... ,R(A+B-1))              */
<a name="OP_RETURN"><span class="definition">OP_RETURN</span></a>,/*    A B     return R(A), ... ,R(A+B-2)      (see note)      */

<a name="OP_FORLOOP"><span class="definition">OP_FORLOOP</span></a>,/*   A sBx   R(A)+=R(A+2);
                        if R(A) &lt;?= R(A+1) then { pc+=sBx; R(A+3)=R(A) }*/
<a name="OP_FORPREP"><span class="definition">OP_FORPREP</span></a>,/*   A sBx   R(A)-=R(A+2); pc+=sBx                           */

<a name="OP_TFORLOOP"><span class="definition">OP_TFORLOOP</span></a>,/*  A C     R(A+3), ... ,R(A+2+C) := R(A)(R(A+1), R(A+2)); 
                        if R(A+3) ~= nil then R(A+2)=R(A+3) else pc++   */ 
<a name="OP_SETLIST"><span class="definition">OP_SETLIST</span></a>,/*   A B C   R(A)[(C-1)*FPF+i] := R(A+i), 1 &lt;= i &lt;= B        */

<a name="OP_CLOSE"><span class="definition">OP_CLOSE</span></a>,/*     A       close all variables in the stack up to (&gt;=) R(A)*/
<a name="OP_CLOSURE"><span class="definition">OP_CLOSURE</span></a>,/*   A Bx    R(A) := closure(KPROTO[Bx], R(A), ... ,R(A+n))  */

<a name="OP_VARARG"><span class="definition">OP_VARARG</span></a>/*     A B     R(A), R(A+1), ..., R(A+B-1) = vararg            */
} <a name="OpCode"><span class="definition">OpCode</span></a>;


#define <a name="NUM_OPCODES"><span class="definition">NUM_OPCODES</span></a>     (<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(int, <a href="https://www.lua.org/source/5.1/lopcodes.h.html#OP_VARARG">OP_VARARG</a>) + 1)



/*===========================================================================
  Notes:
  (*) In <a href="https://www.lua.org/source/5.1/lopcodes.h.html#OP_CALL">OP_CALL</a>, if (B == 0) then B = top. C is the number of returns - 1,
      and can be 0: <a href="https://www.lua.org/source/5.1/lopcodes.h.html#OP_CALL">OP_CALL</a> then sets `top' to last_result+1, so
      next open instruction (<a href="https://www.lua.org/source/5.1/lopcodes.h.html#OP_CALL">OP_CALL</a>, <a href="https://www.lua.org/source/5.1/lopcodes.h.html#OP_RETURN">OP_RETURN</a>, <a href="https://www.lua.org/source/5.1/lopcodes.h.html#OP_SETLIST">OP_SETLIST</a>) may use `top'.

  (*) In <a href="https://www.lua.org/source/5.1/lopcodes.h.html#OP_VARARG">OP_VARARG</a>, if (B == 0) then use actual number of varargs and
      set top (like in <a href="https://www.lua.org/source/5.1/lopcodes.h.html#OP_CALL">OP_CALL</a> with C == 0).

  (*) In <a href="https://www.lua.org/source/5.1/lopcodes.h.html#OP_RETURN">OP_RETURN</a>, if (B == 0) then return up to `top'

  (*) In <a href="https://www.lua.org/source/5.1/lopcodes.h.html#OP_SETLIST">OP_SETLIST</a>, if (B == 0) then B = `top';
      if (C == 0) then next `instruction' is real C

  (*) For comparisons, A specifies what condition the test should accept
      (true or false).

  (*) All `skips' (pc++) assume that next instruction is a jump
===========================================================================*/


/*
** masks for instruction properties. The format is:
** bits 0-1: op mode
** bits 2-3: C arg mode
** bits 4-5: B arg mode
** bit 6: instruction set register A
** bit 7: operator is a test
*/  

enum <a name="OpArgMask"><span class="definition">OpArgMask</span></a> {
  <a name="OpArgN"><span class="definition">OpArgN</span></a>,  /* argument is not used */
  <a name="OpArgU"><span class="definition">OpArgU</span></a>,  /* argument is used */
  <a name="OpArgR"><span class="definition">OpArgR</span></a>,  /* argument is a register or a jump offset */
  <a name="OpArgK"><span class="definition">OpArgK</span></a>   /* argument is a constant or register/constant */
};

<a href="https://www.lua.org/source/5.1/luaconf.h.html#LUAI_DATA">LUAI_DATA</a> const <a href="https://www.lua.org/source/5.1/llimits.h.html#lu_byte">lu_byte</a> <a name="luaP_opmodes"><span class="definition">luaP_opmodes</span></a>[<a href="https://www.lua.org/source/5.1/lopcodes.h.html#NUM_OPCODES">NUM_OPCODES</a>];

#define <a name="getOpMode"><span class="definition">getOpMode</span></a>(m)    (<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(enum <a href="https://www.lua.org/source/5.1/lopcodes.h.html#OpMode">OpMode</a>, <a href="https://www.lua.org/source/5.1/lopcodes.h.html#luaP_opmodes">luaP_opmodes</a>[m] &amp; 3))
#define <a name="getBMode"><span class="definition">getBMode</span></a>(m)     (<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(enum <a href="https://www.lua.org/source/5.1/lopcodes.h.html#OpArgMask">OpArgMask</a>, (<a href="https://www.lua.org/source/5.1/lopcodes.h.html#luaP_opmodes">luaP_opmodes</a>[m] &gt;&gt; 4) &amp; 3))
#define <a name="getCMode"><span class="definition">getCMode</span></a>(m)     (<a href="https://www.lua.org/source/5.1/llimits.h.html#cast">cast</a>(enum <a href="https://www.lua.org/source/5.1/lopcodes.h.html#OpArgMask">OpArgMask</a>, (<a href="https://www.lua.org/source/5.1/lopcodes.h.html#luaP_opmodes">luaP_opmodes</a>[m] &gt;&gt; 2) &amp; 3))
#define <a name="testAMode"><span class="definition">testAMode</span></a>(m)    (<a href="https://www.lua.org/source/5.1/lopcodes.h.html#luaP_opmodes">luaP_opmodes</a>[m] &amp; (1 &lt;&lt; 6))
#define <a name="testTMode"><span class="definition">testTMode</span></a>(m)    (<a href="https://www.lua.org/source/5.1/lopcodes.h.html#luaP_opmodes">luaP_opmodes</a>[m] &amp; (1 &lt;&lt; 7))


<a href="https://www.lua.org/source/5.1/luaconf.h.html#LUAI_DATA">LUAI_DATA</a> const char *const <a name="luaP_opnames"><span class="definition">luaP_opnames</span></a>[<a href="https://www.lua.org/source/5.1/lopcodes.h.html#NUM_OPCODES">NUM_OPCODES</a>+1];  /* opcode names */


/* number of list items to accumulate before a SETLIST instruction */
#define <a name="LFIELDS_PER_FLUSH"><span class="definition">LFIELDS_PER_FLUSH</span></a>       50


#endif
</pre>

<p class="footer">
Last update:
Sat Mar  5 09:19:55 2016
</p>



</body></html>